project_path: /web/_project.yaml book_path: /web/fundamentals/_book.yaml description: بعد التخلص من أية موارد غير لازمة، تأتي خطوة تقليل الحجم الإجمالي للموارد المتبقية التي يتعين على المتصفح تنزيلها، أي ضغطها من خلال تطبيق خوارزميات ضغط عامة (GZip) وأخرى خاصة بأنواع محتوى معين.

{# wf_updated_on: 2014-09-11 #} {# wf_published_on: 2014-03-31 #}

# تحسين الترميز وحجم نقل الأصول القائمة على نصوص {: .page-title }

{% include "web/_shared/contributors/ilyagrigorik.html" %}

تواصل التطبيقات التي نوفرها على الويب نموًا من حيث النطاق والهدف والوظائف - وهذا أمر رائع. إلا أن السعي الحثيث نحو شبكة ويب أكثر تنسيقًا يؤدي إلى اتجاه آخر: ذلك أن حجم البيانات التي يتم تنزيلها من خلال كل تطبيق لا يزال يتزايد بمعدل ثابت. وللحصول على أداء رائع، يلزمنا تحسين عرض كل بايت من البيانات على حدة.

## ضغط البيانات 101

بعد التخلص من أية موارد غير لازمة، تأتي خطوة تقليل الحجم الإجمالي للموارد المتبقية التي يتعين على المتصفح تنزيلها، أي ضغطها. وبناءً على نوع المورد، سواء أكان نصًا أو صورًا أو خطوطًا، فإن لدينا عددًا من الأساليب المختلفة تحت تصرفنا وهي: أدوات عامة يمكن تمكينها على الخادم، وعمليات تحسين ما قبل المعالجة لأنواع محتوى معينة، وعمليات تحسين لموارد معينة تتطلب إدخالاً من المطوِّر.

ويتطلب الحصول على أفضل أداء الجمع بين كل هذه الأساليب.

### TL;DR {: .hide-from-toc }

* عملية الضغط هي عملية لترميز المعلومات باستخدام وحدات بت أقل
* عادة ما يؤدي التخلص من البيانات غير اللازمة إلى الحصول على نتائج أفضل
* هناك العديد من أساليب وخوارزميات الضغط المختلفة
* سيلزمك مجموعة متنوعة من الأساليب لتحقيق أفضل ضغط

تُعرف عملية تقليل حجم البيانات باسم `ضغط البيانات` وهو مجال دراسة واسع ومستقل بذاته: وقد قضى الكثيرون وقتًا طويلاً في عملهم رغبة في الحصول على خوارزميات وأساليب وعمليات تحسين يمكن من خلالها تحسين معدلات الضغط والسرعة وتلبية متطلبات الذاكرة في أدوات ضغط مختلفة. ولا شك أن السياق لا يحتمل نقاشًا مفصلاً حول هذا الموضوع، ولكن لا يزال من المهم استيعاب كيفية عمل الضغط والأساليب المتوفرة لدينا لخفض حجم أصول عدة تطلبها الصفحات.

ولتوضيح المبادئ الأساسية لهذه الأساليب عمليًا، يمكننا التفكير في كيفية تحسين تنسيق رسالة نصية بسيطة يتم ابتكارها خصيصًا لهذا المثال:

    # في ما يلي رسالة سرية تتألف من مجموعة من العناوين بتنسيق
    # قيمة أساسية يتبعه سطر جديد ورسالة مشفرة.
    format: secret-cipher
    date: 04/04/14
    AAAZZBBBBEEEMMM EEETTTAAA
    

1. قد تتضمن الرسائل تعليقات توضيحية عشوائية، تتم الإشارة إليها بالبادئة “#”. لا تؤثر التعليقات التوضيحية في المعنى أو أي سلوك آخر للرسالة.
2. قد تتضمن الرسائل `عناوين` تعد أزواج قيمة أساسية (مفصولة بـ “:”) ويجب أن تظهر في بداية الرسالة.
3. تحمل الرسائل أحمالاً نصية.

فما الذي يمكننا تنفيذه لخفض حجم الرسالة الواردة أعلاه التي يصل عدد أحرفها إلى 200 حرف؟

1. رائع، التعليق مثير، إلا أننا نعرف أنه لا يؤثر في معنى الرسالة، ولذلك فقد قررنا التخلص منه عند نقل الرسالة.
2. ربما تكون هناك بعض الأساليب الذكية التي يمكننا استخدامها لترميز العناوين بطريقة فعالة، على سبيل المثال، لا نعرف ما إذا كانت جميع الرسائل تتضمن `تنسيقًا` و`تاريخًا`، ولكن إذا كان الأمر كذلك، فقد نحولها إلى معرِّفات قصيرة بأرقام صحيحة ونرسلها فقط! إلا أننا لا نضمن ما إذا كان الحال كذلك أم لا، ولذلك سنترك ذلك في الوقت الحالي.
3. The payload is text only, and while we don’t know what the contents of it really are (apparently, it’s using a "secret-message"), just looking at the text shows that there's a lot of redundancy in it. Perhaps instead of sending repeated letters, you can just count the number of repeated letters and encode them more efficiently. For example, "AAA" becomes "3A", which represents a sequence of three A’s.

ومن خلال الجمع بين الأساليب، يمكننا الوصول إلى النتيجة التالية:

    format: secret-cipher
    date: 04/04/14
    3A2Z4B3E3M 3E3T3A
    

تتألف الرسالة الجديدة من 56 حرفًا، وهذا يعني أننا تمكنا من ضغط الرسالة الأصلية بنسبة 72% - حسنًا، ولكن هذه مجرد بداية.

قد ترى أن هذا رائع ولكن تتساءل كيف يمكن الاستفادة من ذلك في تحسين صفحات الويب؟ بالتأكيد لن نجرب ابتكار خوارزميات ضغط، أليس كذلك؟ فعلاً لن يتم ذلك، ولكن كما سترى، سنستخدم الأساليب نفسها وطريقة التفكير نفسها عند تحسين الموارد المتعددة على صفحاتنا: المعالجة المسبقة، وعمليات التحسين الخاصة بالسياق، والخوارزميات المختلفة للمحتوى المختلف.

## الخفض: المعالجة المسبقة وعمليات التحسين الخاصة بالسياق

### TL;DR {: .hide-from-toc }

* يمكن أن تؤدي عمليات التحسين الخاصة بالمحتوى إلى انخفاض كبير في حجم الموارد المعروضة.
* أفضل حال لتطبيق عمليات التحسين الخاصة بالمحتوى في إطار دورة التصميم/التدشين.

الطريقة الأفضل لضغط البيانات المكررة أو غير اللازمة هي تقليصها تمامًا. بالطبع لا يمكننا الاكتفاء بحذف بيانات عشوائية، ولكن في بعض السياقات التي ربما يتوفر فيها معلومات خاصة بالمحتوى في تنسيق البيانات وخصائصها، من الممكن غالبًا خفض حجم الحمل كثيرًا بدون التأثير في المعنى الفعلي.

<pre class="prettyprint">
{% includecode content_path="web/fundamentals/performance/optimizing-content-efficiency/_code/minify.html" region_tag="full" adjust_indentation="auto" %}
</pre>

جرب صفحة HTML البسيطة أعلاه وأنواع المحتوى المختلفة الثلاثة التي تتضمنها: ترميز HTML وأنماط CSS وجافا سكريبت. وكل نوع من أنواع المحتوى هذه يتضمن قواعد مختلفة لما يشكل ترميز HTML صالحًا، وقواعد CSS ومحتوى جافا سكريبت، والقواعد المختلفة للإشارة إلى التعليقات، وهكذا. كيف تمكنا من تقليل حجم هذه الصفحة؟

Consider the simple HTML page above and the three different content types that it contains: HTML markup, CSS styles, and JavaScript. Each of these content types has different rules for what constitutes valid content, different rules for indicating comments, and so on. How can we reduce the size of this page?

* تعد التعليقات على الشفرة خير صديق لمطوِّر الموقع، ولكن لا يحتاج إليها المتصفح! ويمكن أن يؤدي نزع تعليقات CSS (`/* … */`), HTML (`<!-- … -->`), وجافا سكريبت (`// …`) إلى التقليل كثيرًا من إجمالي حجم الصفحة.
* ويمكن أن تلاحظ أداة ضغط CSS `الذكية` أننا نستخدم طريقة غير كافية لتحديد قواعد ‘.awesome-container’ وتقليص الإعلانين إلى واحد بدون التأثير في أية أنماط أخرى، مما يؤدي إلى توفير مزيد من وحدات بايت.
* يساعد المسافات البيضاء (المسافات وعلامات الجدولة) مطوِّر الموقع في HTML وCSS وجافا سكريبت. ويمكن لأداة ضغط إضافية نزع جميع علامات الجدولة والمسافات.

<pre class="prettyprint">
{% includecode content_path="web/fundamentals/performance/optimizing-content-efficiency/_code/minified.html" region_tag="full" adjust_indentation="auto" %}
</pre>

وبعد تطبيق الخطوات الواردة أعلاه تتحول الصفحة من 406 حرفًا إلى 150 حرفًا - أي توفير 63% عن طريق الضغط. ومن المسلم به أنه لا يكون سهل القراءة تمامًا ولكنه لا يجب أن يكون كذلك: ويمكننا الاحتفاظ بالصفحة الأصلية باعتبارها `نسخة تطوير` وتطبيق الخطوات الواردة أعلاه متى كنا على استعداد لتدشين الصفحة على موقع الويب.

وإذا رجعنا خطوة، سنجد أن المثال الوارد أعلاه يوضح نقطة مهمة: يمكن أن تنفذ أداة الضغط لأغراض عامة - كالتي يتم تصميمها لضغط النصوص العشوائية - مهمة كبيرة من خلال ضغط الصفحة أعلاه، ولكنها لن تعرف كيفية نزع التعليقات، وسحب قواعد CSS وعشرات عمليات التحسين الخاص بالمحتوى الأخرى. ولذلك يمكن أن تكون المعالجة المسبقة / الخفض / التحسين مع الدراية بالسياق أداة مفيدة.

Note: على سبيل المثال، تصل نسخة التطوير بدون ضغط من مكتبة JQuery الآن إلى ما يقرب من 300 كيلوبايت. أما المكتبة نفسها بعد خفض حجمها (من خلال إزالة التعليقات وما إلى ذلك)، فتقل بنسبة 3 أضعاف تقريبًا: 100 كيلوبايت.

وبالمثل، يمكن توسيع نطاق الأساليب الواردة أعلاه لتشمل أصولاً غير التي تقوم على نصوص. ذلك أن الصور ومقاطع الفيديو وأنواع المحتوى الأخرى تتضمن جميعها نماذجها الخاصة من البيانات الوصفية والأحمال المتنوعة. على سبيل المثال، عندما تلتقط صورة باستخدام كاميرا، فإن الصورة تضمِّن الكثير من المعلومات الإضافية: إعدادات الكاميرا، والموقع، وهكذا. وبناءً على التطبيق الذي تستخدمه، قد تكون هذه البيانات حرجة (مثل موقع مشاركة الصور)، وقد تكون معدومة الفائدة ويجب التفكير في مدى جدوى عدم إزالتها. وفي الواقع، يمكن أن تضيف هذه البيانات الوصفية عشرات الكيلوبايت لكل صورة.

وباختصار، كخطوة أولى في طريق تحسين كفاءة الأصول، يمكنك تصميم مستودع يتضمن أنواع المحتوى المختلفة والتفكير في أنواع التحسين الخاص بالمحتوى التي يمكنك تطبيقها لخفض الحجم - ويمكن أن يؤدي ذلك إلى توفير الكثير. بعد ذلك، وبمجرد تحديد الأمر، يمكنك إعداد عمليات تحسين تلقائية من خلال إضافتها إلى عمليتي التصميم والتدشين - وهذه هي الطريقة الوحيدة التي يمكن أن تضمن بقاء عمليات التحسين في مكانها.

تعد [GZIP](http://en.wikipedia.org/wiki/Gzip) أداة ضغط عامة يمكن استخدامها مع أي تدفق وحدات بايت: ومن التفاصيل أن هذه الأداة تتذكر بعض المحتوى الذي سبقت مشاهدته وتحاول البحث عن أجزاء البيانات المكررة واستبدالها بطريقة فعالة - ولمن يريد الاطلاع على مزيد من المعلومات، يمكن الحصول على [توضيح رائع للمبتدئين عن GZIP](https://www.youtube.com/watch?v=whGwm0Lky2s&feature=youtu.be&t=14m11s). ولكن بشكل عملي تنفذ GZIP الدور على أفضل نحو مع المحتوى القائم على النصوص، ويتم في الغالب تحقيق معدلات ضغط لا تقل عن 70-90%مع الملفات الكبيرة، بينما يؤدي تشغيل GZIP مع الأصول التي سبق ضغطها باستخدام خوارزميات بديلة (مثل معظم تنسيقات الصور) إلى تحسن بسيط أو لا يؤدي إلى تحسن إطلاقًا.

## ضغط النصوص باستخدام GZIP

### TL;DR {: .hide-from-toc }

* أفضل تطبيق لضغط GZIP يتم على الأصول القائمة على نصوص: في CSS وجافا سكريبت وHTML
* تتوافق جميع المتصفحات الحديثة مع ضغط GZIP وستطلبه تلقائيًا
* يحتاج الخادم إلى التهيئة ليتمكن من إجراء ضغط GZIP
* تتطلب بعض وحدات CDN اهتمامًا خاصًا لضمان تمكين GZIP

وتتوافق جميع المتصفحات الحديثة مع ضغط GZIP كما تتفاوض فيه تلقائيًا بالنسبة إلى جميع طلبات HTTP: والمهمة هنا ضمان تهيئة الخادم على نحو سليم لعرض المورد المضغوط عندما يطلبه العميل.

يوضح الجدول الوارد أعلاه التوفير الذي يمكن الحصول عليه من ضغط GZIP لبعض مكتبات جافا سكريبت الشائعة وإطارات عمل CSS. وتتراوح نسبة التوفير بين 60 و 88%، مع ملاحظة أن الجمع بين الملفات المخفضة (المحددة باستخدام “.min” في اسم الملفات)، بالإضافة إلى GZIP، يؤدي إلى نتيجة أكبر بكثير.

<table>
  
<thead>
  <tr>
    <th>المكتبة</th>
    <th>الحجم</th>
    <th>الحجم بعد الضغط</th>
    <th>معدل الضغط</th>
  </tr>
</thead>

<tr>
  <td data-th="library">jquery-1.11.0.js</td>
  <td data-th="size">276 كيلوبايت</td>
  <td data-th="compressed">82 كيلوبايت</td>
  <td data-th="savings">70%</td>
</tr>
<tr>
  <td data-th="library">jquery-1.11.0.min.js</td>
  <td data-th="size">94 كيلوبايت</td>
  <td data-th="compressed">33 كيلوبايت</td>
  <td data-th="savings">65%</td>
</tr>
<tr>
  <td data-th="library">angular-1.2.15.js</td>
  <td data-th="size">729 كيلوبايت</td>
  <td data-th="compressed">182 كيلوبايت</td>
  <td data-th="savings">75%</td>
</tr>
<tr>
  <td data-th="library">angular-1.2.15.min.js</td>
  <td data-th="size">101 كيلوبايت</td>
  <td data-th="compressed">37 كيلوبايت</td>
  <td data-th="savings">63%</td>
</tr>
<tr>
  <td data-th="library">bootstrap-3.1.1.css</td>
  <td data-th="size">118 كيلوبايت</td>
  <td data-th="compressed">18 كيلوبايت</td>
  <td data-th="savings">85%</td>
</tr>
<tr>
  <td data-th="library">bootstrap-3.1.1.min.css</td>
  <td data-th="size">98 كيلوبايت</td>
  <td data-th="compressed">17 كيلوبايت</td>
  <td data-th="savings">83%</td>
</tr>
<tr>
  <td data-th="library">foundation-5.css</td>
  <td data-th="size">186 كيلوبايت</td>
  <td data-th="compressed">22 كيلوبايت</td>
  <td data-th="savings">88%</td>
</tr>
<tr>
  <td data-th="library">foundation-5.min.css</td>
  <td data-th="size">146 كيلوبايت</td>
  <td data-th="compressed">18 كيلوبايت</td>
  <td data-th="savings">88%</td>
</tr>
</table>

الأهم أن تمكين GZIP يعد إحدى أبسط عمليات التحسين المطلوب تنفيذها وأفضلها من حيث النتائج - ولكن لا يزال الكثيرون يتجاهلون ذلك. معظم خوادم الويب تضغط المحتوى نيابة عنك، ولن تحتاج إلا إلى التحقق من أن الخادم قد هيأ ضغط أنواع المحتوى على نحو سليم يمكن من خلاله الاستفادة من ضغط GZIP.

1. **نفِّذ عمليات التحسين الخاص بالمحتوى أولاً: عمليات الخفض في CSS وجافا سكريبت وHTML .**
2. **استخدم GZIP في ضغط المنتج المخفض.**

ما التهيئة الأفضل للخادم؟ يتضمن مشروع HTML5 Boilerplate [نموذج ملفات تهيئة](https://github.com/h5bp/server-configs) لجميع الخوادم الشائعة التي تتضمن تعليقات مفصلة لكل شارة وإعداد تهيئة: ابحث عن الخادم المفضل من القائمة، وابحث عن قسم GZIP، وأكِّد أنه تمت تهيئة الخادم باستخدام الإعدادات الموصى بها.

The HTML5 Boilerplate project contains [sample configuration files](https://github.com/h5bp/server-configs) for all the most popular servers with detailed comments for each configuration flag and setting. To determine the best configuration for your server, do the following:

* Find your favorite server in the list.
* Look for the GZIP section.
* Confirm that your server is configured with the recommended settings.

<img src="images/transfer-vs-actual-size.png"
  alt="DevTools demo of actual vs transfer size" />

Note: صدق أو لا تصدق، هناك حالات يمكن أن يزيد فيها ضغط GZIP من حجم الأصل. ويحدث هذا عادة عندما يكون الأصل صغيرًا جدًا وتكون تكلفة قاموس GZIP أعلى من توفير الضغط، وإذا كان المورد مضغوطًا بالفعل. وتتيح بعض الخوادم لك تحديد `حد أدنى لحجم الملف` لتجنب حدوث هذه المشكلة.

أخيرًا، هناك تحذير: على الرغم من أن معظم الخوادم ستضغط الأصول تلقائيًا نيابة عنك عند عرضها للمستخدم، تتطلب بعض وحدات CDN مزيدًا من الاهتمام والعمل اليدوي للتأكد من أنه تم تعيين GZIP وفقًا لما يتم عرضه. راجع الموقع وتأكد من أنه [يتم ضغط](http://www.whatsmyip.org/http-compression-test/) الأصول فعلاً!

Finally, while most servers automatically compress the assets for you when serving them to the user, some CDNs require extra care and manual effort to ensure that the GZIP asset is served. Audit your site and ensure that your assets are, in fact, [being compressed](http://www.whatsmyip.org/http-compression-test/).

## Feedback {: #feedback }

{% include "web/_shared/helpful.html" %}